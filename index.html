<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jessie Mathï½œå…­å¹´ç´šæ€æ¨£è§£é¡Œ(ä¸€)ï½œä¸»é¡Œä¹</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* æ ¸å¿ƒè‰²ç›¤ï¼šåƒç…§ Jessie Math Website 2 é¢¨æ ¼ */
      --ink: #1e293b;        /* æ·±è—ç°æ–‡å­— */
      --muted: #64748b;      /* æ¬¡è¦æ–‡å­— */
      --line: #e2e8f0;       /* ç·šæ¢é¡è‰² */
      --bg-page: #f8fafc;    /* é é¢èƒŒæ™¯ */
      
      --brand: #6366f1;      /* ä¸»å“ç‰Œè—ç´«è‰² */
      --brand-light: #e0e7ff; 
      --brand-hover: #4f46e5;

      --accent: #f472b6;     /* è¼”åŠ©ç²‰è‰² */
      
      --good: #10b981;       /* æ­£ç¢º */
      --bad: #ef4444;        /* éŒ¯èª¤ */
      --warn: #f59e0b;       /* è­¦å‘Š/å¼·èª¿ */

      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      
      --radius: 24px;        /* æ›´åœ“æ½¤çš„åœ“è§’ */
      --max: 1100px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: "Plus Jakarta Sans", ui-sans-serif, system-ui, sans-serif;
      color: var(--ink);
      background-color: var(--bg-page);
      /* æŸ”å’Œçš„ç¶²æ ¼æ¼¸å±¤èƒŒæ™¯ */
      background-image: 
        radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
        radial-gradient(at 100% 0%, rgba(244, 114, 182, 0.15) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(99, 102, 241, 0.1) 0px, transparent 50%);
      background-attachment: fixed;
    }

    a{ text-decoration:none; color:inherit; transition:opacity .2s; }
    button{ font-family:inherit; border:none; outline:none; background:none; }

    /* ====== HEADER ====== */
    .hero{
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid rgba(226, 232, 240, 0.8);
      padding: 12px 20px;
      position: sticky;
      top:0;
      z-index: 50;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .hero-inner{
      max-width: var(--max);
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand{
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* é»ƒè‰²åœˆåœˆé ­åƒ (ä¿æŒåŸæ¨£) */
    .avatarRing{
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 3px solid #f59e0b;
      background: transparent;
      display: grid;
      place-items: center;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: 0 4px 6px rgba(245, 158, 11, 0.2);
    }
    .avatarRing img{
      width: 100%; height: 100%; object-fit: contain;
    }

    .brandText{
      font-size: 24px;
      font-weight: 800;
      color: #0f172a;
      letter-spacing: -0.02em;
    }

    .nav{
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .nav a{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 99px;
      font-size: 14px;
      font-weight: 700;
      color: var(--muted);
      transition: all 0.2s ease;
    }
    .nav a:hover{
      background: #f1f5f9;
      color: var(--ink);
    }
    .nav a.current{
      background: var(--brand-light);
      color: var(--brand);
    }
    .nav svg{ width:18px; height:18px; }

    @media(max-width: 768px){
      .hero-inner{ flex-direction: column; align-items: stretch; }
      .brand{ justify-content: center; }
      .nav{ justify-content: center; overflow-x: auto; padding-bottom: 4px; }
      .nav a{ white-space: nowrap; }
    }

    /* ====== MAIN LAYOUT ====== */
    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 30px 20px 80px;
    }

    .titleRow{
      margin-bottom: 24px;
      text-align: left;
    }
    .hTitle{
      margin: 0;
      font-size: clamp(24px, 4vw, 32px);
      font-weight: 800;
      color: var(--ink);
      letter-spacing: -0.03em;
    }
    .sub{
      margin: 8px 0 16px;
      color: var(--muted);
      font-weight: 600;
      font-size: 15px;
      line-height: 1.6;
    }

    .chipRow{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      display: inline-flex;
      padding: 6px 12px;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 8px;
      font-size: 13px;
      font-weight: 700;
      color: var(--muted);
      box-shadow: var(--shadow-sm);
    }

    /* Grid Layout for Game & Leaderboard */
    .grid{
      display: grid;
      grid-template-columns: 1.4fr 0.6fr; /* èª¿æ•´æ¯”ä¾‹ï¼Œå·¦é‚Šå¤§ä¸€é» */
      gap: 24px;
      align-items: start;
    }
    @media(max-width: 900px){ .grid{ grid-template-columns: 1fr; } }

    /* ====== CARDS (The Boxes) ====== */
    .card{
      background: #ffffff;
      border-radius: var(--radius);
      box-shadow: var(--shadow-md);
      overflow: hidden;
      border: 1px solid rgba(226, 232, 240, 0.8);
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }
    /* é ‚éƒ¨è£é£¾æ¢ï¼Œå¢åŠ è³ªæ„Ÿ */
    .card::before{
      content: "";
      position: absolute; top:0; left:0; right:0;
      height: 4px;
      background: var(--brand);
      opacity: 0.8;
    }
    
    .cardHd{
      padding: 16px 24px;
      border-bottom: 1px solid var(--line);
      background: #fff;
      display: flex; justify-content: space-between; align-items: center;
    }
    .cardHd h3{ margin:0; font-size: 18px; font-weight: 800; color: var(--ink); }
    .cardBd{ padding: 24px; }

    /* ====== BUTTONS ====== */
    .btnRow{ display:flex; gap:12px; flex-wrap:wrap; margin-top: 20px; }
    .btn{
      cursor: pointer;
      display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 700;
      transition: all 0.1s;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--muted);
      box-shadow: 0 2px 0 var(--line); /* 3D effect */
    }
    .btn:active{ transform: translateY(2px); box-shadow: none; }
    .btn:hover{ color: var(--ink); background: #f8fafc; }

    .btn.primary{
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
      box-shadow: 0 3px 0 #4338ca;
    }
    .btn.primary:hover{ background: var(--brand-hover); }
    .btn.primary:active{ box-shadow: none; transform: translateY(3px); }

    .btn.warn{
      background: #fffbeb; color: #b45309; border-color: #fcd34d;
      box-shadow: 0 2px 0 #fcd34d;
    }
    .btn.danger{
      background: #fef2f2; color: #b91c1c; border-color: #fca5a5;
      box-shadow: 0 2px 0 #fca5a5;
    }
    .btn:disabled{ opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

    /* ====== GAME UI ====== */
    .screen{ display:none; animation: fadeUp 0.4s ease; }
    .screen.active{ display:block; }
    @keyframes fadeUp{ from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

    .kpis{
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }
    .kpi{
      background: #f8fafc;
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      text-align: center;
    }
    .kpi .t{ font-size: 12px; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
    .kpi .v{ font-size: 22px; font-weight: 800; color: var(--ink); margin-top: 4px; }
    .mono{ font-family: 'Courier New', Courier, monospace; letter-spacing: -1px; }

    /* Illustration Area */
    .illustration{
      background: linear-gradient(135deg, #fefce8 0%, #fff 100%);
      border: 2px dashed #fcd34d;
      border-radius: 20px;
      padding: 20px;
      margin: 20px 0;
      display: flex; align-items: center; gap: 20px;
    }
    .illuSvg{ width: 64px; height: 64px; flex-shrink: 0; }
    
    .qCard{
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 20px;
      padding: 24px;
      position: relative;
      box-shadow: var(--shadow-sm);
    }
    .qTypeBadge{
      position: absolute; top: -12px; left: 24px;
      background: var(--brand); color: #fff;
      font-size: 12px; font-weight: 800;
      padding: 4px 12px; border-radius: 20px;
      box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
    }
    .qText{
      font-size: 18px; line-height: 1.6; font-weight: 700; color: var(--ink);
      margin: 10px 0 24px;
    }

    /* Answers */
    .choices{ display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .choiceBtn{
      background: #fff;
      border: 2px solid var(--line);
      padding: 16px;
      border-radius: 16px;
      text-align: left;
      font-weight: 700;
      color: var(--ink);
      cursor: pointer;
      transition: all 0.2s;
    }
    .choiceBtn:hover{ border-color: var(--brand); background: var(--brand-light); color: var(--brand); }
    
    .inputRow{ display: flex; gap: 12px; }
    .in{
      flex: 1;
      padding: 14px;
      border: 2px solid var(--line);
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      outline: none;
      transition: border-color 0.2s;
    }
    .in:focus{ border-color: var(--brand); }

    /* Feedback */
    .feedback{
      margin-top: 20px; padding: 16px; border-radius: 16px; display: none;
    }
    .feedback.show{ display: block; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .feedback.good{ background: #ecfdf5; border: 1px solid #d1fae5; color: #047857; }
    .feedback.bad{ background: #fef2f2; border: 1px solid #fee2e2; color: #b91c1c; }
    @keyframes pop{ from{transform:scale(0.9);} to{transform:scale(1);} }

    /* Overlay */
    .pauseOverlay{
      position: absolute; inset: 0; background: rgba(255,255,255,0.9);
      backdrop-filter: blur(4px); z-index: 10;
      display: none; place-items: center; border-radius: var(--radius);
    }
    .pauseOverlay.show{ display: grid; }
    .pauseBox{ text-align: center; }

    /* Leaderboard Styles */
    .lbRow{
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 16px;
      margin-bottom: 8px;
      background: #f8fafc;
      border-radius: 12px;
      border: 1px solid transparent;
    }
    .lbRow:hover{ border-color: var(--line); background: #fff; }
    .lbRank{
      width: 28px; height: 28px;
      background: #e2e8f0; color: var(--muted);
      border-radius: 8px;
      display: grid; place-items: center;
      font-weight: 800; font-size: 13px;
    }
    .lbRow:nth-child(1) .lbRank{ background: #fcd34d; color: #92400e; }
    .lbRow:nth-child(2) .lbRank{ background: #cbd5e1; color: #475569; }
    .lbRow:nth-child(3) .lbRank{ background: #fdba74; color: #9a3412; }

    /* Modal */
    .modal{
      position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6);
      z-index: 100; display: none; place-items: center; padding: 20px;
      backdrop-filter: blur(4px);
    }
    .modal.show{ display: grid; }
    .modalBox{
      background: #fff; width: min(480px, 100%);
      border-radius: 24px; overflow: hidden;
      box-shadow: var(--shadow-lg);
    }
    .modalHd{ padding: 20px; background: #f8fafc; border-bottom: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center; }
    .modalBd{ padding: 24px; }
  </style>
</head>
<body>

  <header class="hero">
    <div class="hero-inner">
      <a href="#" class="brand">
        <div class="avatarRing">
          <img src="JESSIEMATH-Q.png" alt="Jessie Math">
        </div>
        <div class="brandText">Jessie Math</div>
      </a>

      <nav class="nav">
        <a href="https://jessiemath0703-chu.github.io/website2/" target="_blank">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
          é¦–é 
        </a>
        <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" target="_blank">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
          éŠæˆ²å¤§å»³
        </a>
        <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" target="_blank" class="current">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
          å…­å¹´ç´šæ€æ¨£è§£é¡Œ(ä¸€)å’Œå·®å•†ç©èˆ‡é›å…”å•é¡Œ
        </a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    
    <div class="titleRow">
      <h1 class="hTitle">æ€æ¨£è§£é¡Œ(ä¸€)ï½œå’Œå·®å•†ç©èˆ‡é›å…”å•é¡Œ</h1>
      <p class="sub">ä¸»é¡Œä¹ï½œåœ¨ 60 ç§’å…§çœ‹ç©¿é¡Œç›®çš„ã€Œä¸è®Šé‡ã€ã€‚ä¿æŒé€£æ“Šï¼Œåˆ†æ•¸åŠ å€ã€‚</p>
      <div class="chipRow">
        <span class="chip">â±ï¸ 60ç§’/å±€</span>
        <span class="chip">âœ¨ ç­”å°+5ç§’</span>
        <span class="chip">ğŸ’¥ é€£æ“ŠåŠ åˆ†</span>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <div class="cardHd">
          <h3 id="screenTitle">éŠæˆ²å€åŸŸ</h3>
          <div style="display:flex; gap:4px;">
            <div style="width:10px; height:10px; border-radius:50%; background:#f87171;"></div>
            <div style="width:10px; height:10px; border-radius:50%; background:#fbbf24;"></div>
            <div style="width:10px; height:10px; border-radius:50%; background:#34d399;"></div>
          </div>
        </div>
        <div class="cardBd">
          
          <div id="screenWelcome" class="screen active">
            <div style="text-align:center; padding: 20px 0;">
              <div style="width:80px; height:80px; background:#eff6ff; border-radius:50%; margin:0 auto 20px; display:grid; place-items:center; color:var(--brand);">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
              </div>
              <h2 style="margin:0; font-size:20px;">æ­¡è¿ä¾†åˆ°è§£é¡Œè©¦ç…‰å ´</h2>
              <p style="color:var(--muted); margin:10px 0 30px; line-height:1.6;">
                é€™è£¡ä¸åªè€ƒç®—è¡“ï¼Œæ›´è€ƒä½ çš„é‚è¼¯çœ¼åŠ›ã€‚<br>
                è«‹å…ˆè¼¸å…¥åå­—ï¼Œæ–¹ä¾¿ç´€éŒ„æ’è¡Œæ¦œã€‚
              </p>
              <div class="btnRow" style="justify-content:center;">
                <button class="btn primary" onclick="app.toSelect()">
                  é–‹å§‹éŠæˆ²
                </button>
                <button class="btn" onclick="app.toggleHow(true)">
                  è¦å‰‡èªªæ˜
                </button>
              </div>
            </div>
          </div>

          <div id="screenSelect" class="screen">
             <div class="kpis">
               <div class="kpi"><div class="t">ç©å®¶</div><div class="v" id="uiName">-</div></div>
               <div class="kpi"><div class="t">ç›®å‰é—œå¡</div><div class="v" id="uiLvl" style="font-size:16px;">å°šæœªé¸æ“‡</div></div>
             </div>
             
             <div style="background:#f8fafc; padding:20px; border-radius:16px; border:1px solid var(--line);">
               <p style="font-weight:700; margin-bottom:12px; margin-top:0;">1. é¸æ“‡é—œå¡ï¼š</p>
               <div class="btnRow" id="lvlBtns" style="margin-top:0;"></div>

               <div style="height:1px; background:var(--line); margin:20px 0;"></div>

               <p style="font-weight:700; margin-bottom:12px;">2. é¸æ“‡é›£åº¦ï¼š</p>
               <div class="btnRow" id="diffBtns" style="margin-top:0;">
                 <button class="btn" onclick="app.setDiff('easy')" data-d="easy">è¼•é¬†</button>
                 <button class="btn" onclick="app.setDiff('normal')" data-d="normal">æ¨™æº–</button>
                 <button class="btn" onclick="app.setDiff('hard')" data-d="hard">é€²éš</button>
               </div>
             </div>

             <div class="btnRow" style="margin-top:24px; justify-content:flex-end;">
               <button class="btn" onclick="app.changeName()">ä¿®æ”¹åå­—</button>
               <button class="btn primary" id="btnStartGame" disabled onclick="app.startGame()" style="min-width:160px; justify-content:center;">
                 é€²å…¥é—œå¡ (60s)
               </button>
             </div>
          </div>

          <div id="screenGame" class="screen">
            <div class="kpis">
              <div class="kpi"><div class="t">æ™‚é–“</div><div class="v mono" id="hudTime">60</div></div>
              <div class="kpi"><div class="t">åˆ†æ•¸</div><div class="v mono" id="hudScore">0</div></div>
              <div class="kpi"><div class="t">é€£æ“Š</div><div class="v mono" id="hudCombo">0</div></div>
              <div class="kpi"><div class="t">å€ç‡</div><div class="v mono" id="hudMult">x1</div></div>
            </div>

            <div class="btnRow" style="justify-content:flex-end; margin:0 0 16px;">
              <button class="btn danger" style="padding:6px 12px; font-size:13px;" onclick="app.restart()">é‡æ–°</button>
              <button class="btn warn" style="padding:6px 12px; font-size:13px;" onclick="app.pause(true)">æš«åœ</button>
              <button class="btn" style="padding:6px 12px; font-size:13px;" onclick="app.toMenu()">ä¸»é¸å–®</button>
            </div>

            <div class="illustration">
              <div class="illuSvg" id="gameSvg"></div>
              <div>
                <div style="font-weight:800; font-size:16px; color:var(--brand);" id="gameIlluTitle">æƒ…å¢ƒå¡</div>
                <div style="font-size:14px; color:var(--muted); margin-top:4px;" id="gameIlluDesc">èªªæ˜æ–‡å­—</div>
              </div>
            </div>

            <div class="qCard">
              <span class="qTypeBadge" id="qBadge">å¡«å……é¡Œ</span>
              <div class="qText" id="qText">é¡Œç›®è¼‰å…¥ä¸­...</div>
              
              <div id="answerZone"></div>

              <div class="feedback" id="feedback">
                <div style="font-weight:800; font-size:16px;" id="fbTitle"></div>
                <div style="font-size:14px; margin-top:4px; opacity:0.9;" id="fbDesc"></div>
              </div>
            </div>

            <div class="pauseOverlay" id="pauseOverlay">
              <div class="pauseBox">
                <div style="font-size:48px; margin-bottom:10px;">â¸ï¸</div>
                <h2 style="margin:0;">æš«åœä¸­</h2>
                <p style="color:var(--muted);">æ·±å‘¼å¸ï¼Œæƒ³å¥½å†æˆ°ã€‚</p>
                <button class="btn primary" onclick="app.pause(false)">ç¹¼çºŒéŠæˆ²</button>
              </div>
            </div>
          </div>

          <div id="screenResult" class="screen">
            <div style="text-align:center; padding:20px;">
              <h2 style="margin:0;">çµç®—æˆç¸¾</h2>
              <div class="v stars" style="font-size:40px; color:#fbbf24; margin:10px 0; text-shadow:0 2px 4px rgba(0,0,0,0.1);" id="resStars">â˜…â˜…â˜…</div>
              <p style="color:var(--muted); font-size:16px;">åšå¾—å¥½ï¼Œ<strong style="color:var(--ink);" id="resName"></strong>ï¼</p>
              
              <div style="display:flex; justify-content:center; gap:20px; margin:30px 0;">
                <div style="text-align:center;">
                    <div style="font-size:12px; color:var(--muted); font-weight:700;">ç¸½åˆ†</div>
                    <div style="font-size:28px; font-weight:800; color:var(--brand);" id="resScore">0</div>
                </div>
                <div style="width:1px; background:var(--line);"></div>
                <div style="text-align:center;">
                    <div style="font-size:12px; color:var(--muted); font-weight:700;">æœ€é«˜é€£æ“Š</div>
                    <div style="font-size:28px; font-weight:800; color:var(--ink);" id="resCombo">0</div>
                </div>
              </div>

              <div class="btnRow" style="justify-content:center;">
                <button class="btn primary" onclick="app.restart()">å†ä¾†ä¸€å±€</button>
                <button class="btn" onclick="app.toMenu()">å›ä¸»é¸å–®</button>
              </div>
            </div>
          </div>

        </div>
      </section>

      <aside class="card">
        <div class="cardHd">
          <h3>ğŸ† æ’è¡Œæ¦œ</h3>
        </div>
        <div class="cardBd">
          <div style="font-size:13px; color:var(--muted); margin-bottom:14px; font-weight:600; background:#f1f5f9; padding:8px; border-radius:8px; text-align:center;">
            <span id="lbLabel">è«‹å…ˆé¸æ“‡é—œå¡æŸ¥çœ‹ç´€éŒ„</span>
          </div>
          <div id="lbList" style="min-height:100px;"></div>
          <button class="btn" style="width:100%; margin-top:20px; font-size:12px; justify-content:center;" onclick="app.clearLB()">
            æ¸…é™¤æ­¤é—œå¡ç´€éŒ„
          </button>
        </div>
      </aside>
    </div>
  </main>

  <div class="modal" id="modalName">
    <div class="modalBox">
      <div class="modalHd">
        <h4 style="margin:0;">è¼¸å…¥åå­—</h4>
      </div>
      <div class="modalBd">
        <p style="margin-top:0; color:var(--muted);">æ’è¡Œæ¦œéœ€è¦çŸ¥é“ä½ æ˜¯èª°ï¼š</p>
        <div class="inputRow">
          <input type="text" class="in" id="inputName" placeholder="ä¾‹å¦‚ï¼šæ•¸å­¸å°ç‹å­" maxlength="10">
          <button class="btn primary" onclick="app.saveName()">ç¢ºå®š</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalHow">
    <div class="modalBox">
      <div class="modalHd">
        <h4 style="margin:0;">éŠæˆ²èªªæ˜</h4>
        <button class="btn" style="padding:4px 8px;" onclick="app.toggleHow(false)">X</button>
      </div>
      <div class="modalBd" style="line-height:1.6; color:var(--ink);">
        <p><strong>ç›®æ¨™ï¼š</strong>åœ¨ 60 ç§’å…§ç­”å°è¶Šå¤šé¡Œè¶Šå¥½ã€‚</p>
        <ul style="padding-left:20px; color:var(--muted); margin-bottom:20px;">
          <li style="margin-bottom:6px;"><strong>ç­”å°ï¼š</strong>+5 ç§’ï¼Œç´¯ç©é€£æ“Š Comboã€‚</li>
          <li style="margin-bottom:6px;"><strong>ç­”éŒ¯ï¼š</strong>-5 ç§’ï¼Œé€£æ“Šæ­¸é›¶ã€‚</li>
          <li><strong>é€£æ“ŠåŠ åˆ†ï¼š</strong>3é€£æ“Šä»¥ä¸Šåˆ†æ•¸ x1.5ï¼Œ6é€£æ“Š x2ï¼Œ9é€£æ“Š x3ã€‚</li>
        </ul>
        <button class="btn primary" style="width:100%; justify-content:center;" onclick="app.toggleHow(false)">æ‡‚äº†ï¼Œé–‹æˆ°ï¼</button>
      </div>
    </div>
  </div>

  <script>
    // å·¥å…·å‡½å¼
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    
    // éŠæˆ²ä¸»é‚è¼¯
    const app = {
      state: {
        player: localStorage.getItem('JM_P9_NAME') || '',
        level: 0,
        diff: '',
        score: 0,
        time: 60,
        combo: 0,
        maxCombo: 0,
        timer: null,
        paused: false,
        q: null
      },
      
      levels: [
        {id:1, name:'ç¬¬ä¸€é—œï¼šå’Œä¸è®Š', svg:`<circle cx="30" cy="30" r="25" fill="#e0e7ff" stroke="#6366f1" stroke-width="3"/><text x="30" y="38" text-anchor="middle" fill="#6366f1" font-weight="800" font-size="24">+</text>`},
        {id:2, name:'ç¬¬äºŒé—œï¼šå·®ä¸è®Š', svg:`<rect x="10" y="20" width="40" height="20" rx="6" fill="#fee2e2" stroke="#ef4444" stroke-width="3"/><text x="30" y="38" text-anchor="middle" fill="#ef4444" font-weight="800" font-size="24">-</text>`},
        {id:3, name:'ç¬¬ä¸‰é—œï¼šç©ä¸è®Š', svg:`<polygon points="30,5 55,55 5,55" fill="#fef3c7" stroke="#f59e0b" stroke-width="3"/><text x="30" y="45" text-anchor="middle" fill="#b45309" font-weight="800" font-size="24">Ã—</text>`},
        {id:4, name:'ç¬¬å››é—œï¼šå•†ä¸è®Š', svg:`<circle cx="15" cy="15" r="5" fill="#cbd5e1"/><circle cx="45" cy="45" r="5" fill="#cbd5e1"/><line x1="10" y1="50" x2="50" y2="10" stroke="#64748b" stroke-width="3"/>`},
        {id:5, name:'ç¬¬äº”é—œï¼šé›å…”åŒç± ', svg:`<path d="M10 30 Q30 5 50 30" stroke="#6366f1" stroke-width="3" fill="none"/><circle cx="20" cy="30" r="4" fill="#6366f1"/><circle cx="40" cy="30" r="4" fill="#6366f1"/>`}
      ],

      init(){
        this.renderLvlBtns();
        this.updateLB();
        if(!this.state.player) $('#modalName').classList.add('show');
      },

      saveName(){
        const name = $('#inputName').value.trim();
        if(name){
          this.state.player = name;
          localStorage.setItem('JM_P9_NAME', name);
          $('#modalName').classList.remove('show');
          $('#uiName').textContent = name;
        }
      },

      changeName(){
        $('#inputName').value = this.state.player;
        $('#modalName').classList.add('show');
      },

      toSelect(){
        this.showScreen('screenSelect');
        $('#uiName').textContent = this.state.player;
      },

      showScreen(id){
        $$('.screen').forEach(el => el.classList.remove('active'));
        $('#'+id).classList.add('active');
        $('#screenTitle').textContent = 
          id === 'screenWelcome' ? 'éŠæˆ²å…¥å£' :
          id === 'screenSelect' ? 'é¸æ“‡é—œå¡' :
          id === 'screenGame' ? 'æŒ‘æˆ°ä¸­' : 'çµç®—';
      },

      renderLvlBtns(){
        const box = $('#lvlBtns');
        box.innerHTML = this.levels.map(l => 
          `<button class="btn" onclick="app.setLevel(${l.id})" data-id="${l.id}">${l.name}</button>`
        ).join('');
      },

      setLevel(id){
        this.state.level = id;
        $$('#lvlBtns .btn').forEach(b => {
          b.classList.toggle('primary', parseInt(b.dataset.id) === id);
        });
        $('#uiLvl').textContent = this.levels.find(l=>l.id===id).name;
        this.checkStart();
        this.updateLB();
      },

      setDiff(d){
        this.state.diff = d;
        $$('#diffBtns .btn').forEach(b => {
          b.classList.toggle('primary', b.dataset.d === d); // ä¿®æ”¹æ¨£å¼é‚è¼¯
        });
        this.checkStart();
        this.updateLB();
      },

      checkStart(){
        $('#btnStartGame').disabled = !(this.state.level && this.state.diff);
      },

      toggleHow(show){
        $('#modalHow').classList.toggle('show', show);
      },

      // --- éŠæˆ²å¼•æ“ ---

      startGame(){
        this.state.score = 0;
        this.state.time = 60;
        this.state.combo = 0;
        this.state.maxCombo = 0;
        this.state.paused = false;
        
        this.showScreen('screenGame');
        $('#pauseOverlay').classList.remove('show');
        $('#feedback').classList.remove('show');
        
        const lvlInfo = this.levels.find(l => l.id === this.state.level);
        $('#gameSvg').innerHTML = lvlInfo.svg;
        $('#gameIlluTitle').textContent = lvlInfo.name;
        $('#gameIlluDesc').textContent = this.getLevelDesc(this.state.level);

        this.updateHUD();
        this.nextQuestion();
        
        clearInterval(this.state.timer);
        this.state.timer = setInterval(() => {
          if(!this.state.paused){
            this.state.time--;
            this.updateHUD();
            if(this.state.time <= 0) this.endGame();
          }
        }, 1000);
      },

      getLevelDesc(id){
        const descs = [
          "",
          "å’Œä¸€å®šï¼šAè®Šå¤§ï¼ŒBå°±è¦è®Šå°ã€‚",
          "å·®ä¸€å®šï¼šå…©å€‹æ•¸è·é›¢å›ºå®šï¼Œä¸€èµ·è®Šå¤§è®Šå°ã€‚",
          "ç©ä¸€å®šï¼šAè®Šå¤§ï¼ŒBå°±è¦ç¸®å°ï¼ˆåæ¯”ï¼‰ã€‚",
          "å•†ä¸€å®šï¼šAè®Šå¤§ï¼ŒBä¹Ÿè¦è®Šå¤§ï¼ˆæ­£æ¯”ï¼‰ã€‚",
          "é›å…”å•é¡Œï¼šé ­æ•¸å›ºå®šï¼Œç”¨è…³æ•¸ä¾†æ¨ç†ã€‚"
        ];
        return descs[id];
      },

      pause(isPaused){
        this.state.paused = isPaused;
        $('#pauseOverlay').classList.toggle('show', isPaused);
      },

      restart(){
        this.startGame();
      },

      toMenu(){
        clearInterval(this.state.timer);
        this.showScreen('screenSelect');
      },

      updateHUD(){
        $('#hudTime').textContent = this.state.time;
        $('#hudScore').textContent = this.state.score;
        $('#hudCombo').textContent = this.state.combo;
        const mul = this.getMult();
        $('#hudMult').textContent = 'x' + mul;
        if(this.state.time <= 10) $('#hudTime').style.color = 'var(--bad)';
        else $('#hudTime').style.color = 'var(--ink)';
      },

      getMult(){
        if(this.state.combo >= 9) return 3;
        if(this.state.combo >= 6) return 2;
        if(this.state.combo >= 3) return 1.5;
        return 1;
      },

      nextQuestion(){
        $('#feedback').classList.remove('show');
        const q = this.genQuestion();
        this.state.q = q;
        
        $('#qBadge').textContent = q.type === 'fill' ? 'å¡«å……é¡Œ' : q.type === 'tf' ? 'æ˜¯éé¡Œ' : 'é¸æ“‡é¡Œ';
        $('#qText').textContent = q.text;
        
        const zone = $('#answerZone');
        zone.innerHTML = '';

        if(q.type === 'fill'){
          zone.innerHTML = `
            <div class="inputRow">
              <input type="number" class="in" id="ansInput" placeholder="è¼¸å…¥æ•¸å­—" autocomplete="off">
              <button class="btn primary" onclick="app.checkAnswer()">é€å‡º</button>
            </div>
          `;
          setTimeout(()=>$('#ansInput').focus(), 50);
          $('#ansInput').onkeydown = (e) => { if(e.key === 'Enter') app.checkAnswer(); };
        } else if(q.type === 'mc'){
          const div = document.createElement('div');
          div.className = 'choices';
          q.opts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'choiceBtn';
            btn.innerHTML = `<span>${opt}</span>`;
            btn.onclick = () => app.checkAnswer(opt);
            div.appendChild(btn);
          });
          zone.appendChild(div);
        } else { // tf
          const div = document.createElement('div');
          div.className = 'choices';
          ['O (æ­£ç¢º)', 'X (éŒ¯èª¤)'].forEach((txt, i) => {
            const btn = document.createElement('button');
            btn.className = 'choiceBtn';
            btn.textContent = txt;
            btn.onclick = () => app.checkAnswer(i === 0);
            div.appendChild(btn);
          });
          zone.appendChild(div);
        }
      },

      genQuestion(){
        const l = this.state.level;
        const d = this.state.diff;
        const max = d === 'easy' ? 20 : d === 'normal' ? 50 : 100;
        const min = d === 'easy' ? 2 : 5;
        
        let q = { text:'', ans:0, type: Math.random() > 0.6 ? 'fill' : Math.random() > 0.5 ? 'mc' : 'tf' };
        
        if(l === 5){
           const heads = rand(min + 5, max/2);
           const rabbits = rand(1, heads-1);
           const chickens = heads - rabbits;
           const legs = chickens*2 + rabbits*4;
           
           const askChicken = Math.random() > 0.5;
           q.text = `ç± å­è£¡æœ‰ ${heads} å€‹é ­ï¼Œ${legs} éš»è…³ã€‚è«‹å•æœ‰å¹¾éš»${askChicken ? 'é›' : 'å…”å­'}ï¼Ÿ`;
           q.ans = askChicken ? chickens : rabbits;
           q.explain = `é›+å…”=${heads}, 2é›+4å…”=${legs}ã€‚è§£å¾— é›=${chickens}, å…”=${rabbits}ã€‚`;
        } else {
           const a = rand(min, max);
           const b = rand(min, max);
           
           if(l === 1){
             const sum = a + b;
             q.text = `å…©æ•¸çš„å’Œæ˜¯ ${sum}ã€‚å…¶ä¸­ä¸€å€‹æ•¸æ˜¯ ${a}ï¼Œå¦ä¸€å€‹æ•¸æ˜¯ï¼Ÿ`;
             q.ans = b;
             q.explain = `${sum} - ${a} = ${b}`;
           } else if(l === 2){
             const big = Math.max(a, b);
             const small = Math.min(a, b);
             const diff = big - small;
             q.text = `å…©æ•¸ç›¸å·® ${diff}ã€‚å¤§æ•¸æ˜¯ ${big}ï¼Œå°æ•¸æ˜¯ï¼Ÿ`;
             q.ans = small;
             q.explain = `${big} - ${diff} = ${small}`;
           } else if(l === 3){
             const prod = a * b;
             q.text = `å…©æ•¸çš„ç©æ˜¯ ${prod}ã€‚å…¶ä¸­ä¸€å€‹æ•¸æ˜¯ ${a}ï¼Œå¦ä¸€æ•¸æ˜¯ï¼Ÿ`;
             q.ans = b;
             q.explain = `${prod} Ã· ${a} = ${b}`;
           } else if(l === 4){
             q.text = `ç”² Ã· ä¹™ çš„å•†æ˜¯ ${a}ã€‚å¦‚æœä¹™æ˜¯ ${b}ï¼Œç”²æ˜¯å¤šå°‘ï¼Ÿ`;
             q.ans = a * b;
             q.explain = `è¢«é™¤æ•¸ = å•† Ã— é™¤æ•¸ (${a} Ã— ${b} = ${q.ans})`;
           }
        }

        if(q.type === 'mc'){
          let opts = new Set([q.ans]);
          while(opts.size < 4){
             opts.add(q.ans + rand(-10, 10));
          }
          q.opts = Array.from(opts).sort(() => Math.random() - 0.5);
        }
        if(q.type === 'tf'){
          const isTrue = Math.random() > 0.5;
          if(!isTrue) {
            let fake = q.ans + rand(1, 5) * (Math.random() > 0.5 ? 1 : -1);
            q.displayAns = fake; 
            q.text += ` ç­”æ¡ˆæ˜¯ ${fake} å—ï¼Ÿ`;
            q.ans = false;
          } else {
            q.text += ` ç­”æ¡ˆæ˜¯ ${q.ans} å—ï¼Ÿ`;
            q.ans = true;
          }
        }
        return q;
      },

      checkAnswer(val){
        if(val === undefined && this.state.q.type === 'fill'){
          val = parseInt($('#ansInput').value);
        }

        const isCorrect = val == this.state.q.ans;
        const fb = $('#feedback');
        
        if(isCorrect){
          this.state.combo++;
          if(this.state.combo > this.state.maxCombo) this.state.maxCombo = this.state.combo;
          this.state.time += 5;
          this.state.score += 10 * this.getMult();
          
          fb.className = 'feedback show good';
          $('#fbTitle').innerHTML = 'âœ… ç­”å°äº†ï¼ <span style="font-size:12px">+5ç§’</span>';
          $('#fbDesc').textContent = 'ä¿æŒç¯€å¥ï¼Œé€£æ“Šè¶Šé«˜åˆ†è¶Šå¤šï¼';
        } else {
          this.state.combo = 0;
          this.state.time -= 5;
          
          fb.className = 'feedback show bad';
          $('#fbTitle').innerHTML = 'âŒ ç­”éŒ¯äº† <span style="font-size:12px">-5ç§’</span>';
          const rightAns = this.state.q.type === 'tf' ? (this.state.q.ans ? 'O' : 'X') : this.state.q.ans;
          $('#fbDesc').textContent = `æ­£ç¢ºç­”æ¡ˆï¼š${rightAns} (${this.state.q.explain || ''})`;
        }
        
        this.updateHUD();
        
        $$('#answerZone button, #answerZone input').forEach(e => e.disabled = true);
        
        setTimeout(() => {
          if(this.state.time > 0) this.nextQuestion();
        }, 1200);
      },

      endGame(){
        clearInterval(this.state.timer);
        this.showScreen('screenResult');
        $('#resName').textContent = this.state.player;
        $('#resScore').textContent = this.state.score;
        $('#resCombo').textContent = this.state.maxCombo;
        
        let stars = 'â˜…â˜†â˜†';
        if(this.state.score > 300) stars = 'â˜…â˜…â˜†';
        if(this.state.score > 600) stars = 'â˜…â˜…â˜…';
        $('#resStars').textContent = stars;

        const key = `JM_LB_L${this.state.level}_${this.state.diff}`;
        let lb = JSON.parse(localStorage.getItem(key) || '[]');
        lb.push({ name: this.state.player, score: this.state.score, date: new Date().toLocaleDateString() });
        lb.sort((a,b) => b.score - a.score);
        localStorage.setItem(key, JSON.stringify(lb.slice(0, 10)));
        
        this.updateLB();
      },

      updateLB(){
        const key = `JM_LB_L${this.state.level}_${this.state.diff}`;
        const lbl = $('#lbLabel');
        const list = $('#lbList');
        
        if(!this.state.level || !this.state.diff){
          list.innerHTML = '';
          lbl.textContent = 'è«‹å…ˆé¸æ“‡å·¦å´é—œå¡èˆ‡é›£åº¦';
          return;
        }

        const lb = JSON.parse(localStorage.getItem(key) || '[]');
        lbl.textContent = `é¡¯ç¤ºï¼š${this.levels.find(l=>l.id==this.state.level).name} (${this.state.diff})`;
        
        if(lb.length === 0){
          list.innerHTML = '<div style="text-align:center; color:var(--muted); padding:20px;">å°šç„¡ç´€éŒ„ï¼Œå¿«ä¾†æ¶é ­é¦™ï¼</div>';
        } else {
          list.innerHTML = lb.map((r, i) => `
            <div class="lbRow">
              <div style="display:flex; align-items:center; gap:10px;">
                <div class="lbRank">${i+1}</div>
                <div style="font-weight:700;">${r.name}</div>
              </div>
              <div class="mono" style="font-weight:800; color:var(--brand);">${r.score}</div>
            </div>
          `).join('');
        }
      },

      clearLB(){
        if(confirm('ç¢ºå®šè¦æ¸…é™¤é€™å€‹é—œå¡çš„æ’è¡Œæ¦œå—ï¼Ÿ')){
          const key = `JM_LB_L${this.state.level}_${this.state.diff}`;
          localStorage.removeItem(key);
          this.updateLB();
        }
      }
    };

    app.init();
  </script>
</body>
</html>